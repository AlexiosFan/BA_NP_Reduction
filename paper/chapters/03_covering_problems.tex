\chapter{Set Covering Problems}\label{chapter:covering}
In this chapter, we discuss about the \textbf{NP-Hardness} of a few set covering problems. 
Covering problems ask whether a certain combinatorical structure $A$ covers another structure $B$. 
Alternatively, it may also ask for the minimal size of $A$ to cover $B$. 
We focus on a subclass of covering problems, the exact covering problem. In this subclass, 
$A$ covers $B$ exactly, i.e. no element in $B$ is covered twice in $A$. 
In Karp's paper in 1972, the following covering problems were included: Exact Cover, Exact Hitting Set,
3-Dimensional Matching, and Steiner Tree. In our implementation, we reduced \SAT\ to \XC, and then reduced \XC\ to \HS. 

\section{Exact Cover}
The exact cover problem is a special case of the set cover problem. Besides the covering property, it also requires the uniqueness of the elements. 
\problem{\XC}{A set $X$ and a collection $S$ of subsets of $X$.}{Is there a disjoint subset $S'$ of $S$ s.t. 
each element in $X$ is contained in one of the elements of $S'$?}
\Snippet{exact-cover-def}

\subsection{Choice of reduction}
Since \XC\ is a fundamental \NPH\ problem, there are many different reductions available. 
Karp's reduction based on the chromatic number problem. 
Although the chromatic number problem was formalized in Karp's 21 project, we did not choose this reduction
because of the complexity of the graph traversal and the differences between Karp's definition and the available Isabelle's definition. 
Additionaly, there is an easy reduction from \SAT\ to \XC. This reduction does not involve graph traversal.
The only technical barrier is the typeless set. While Isabelle only supports typed sets, we resolve this problem
by creating a container type. More details follow in the section \ref*{sec:sat-imp}. 

\subsection{Reduction Details}
Given a propositional logical formula $F$, we index the variables and the clauses and use the following notations.
\begin{enumerate}
    \item $x_i$ denotes the $i$-th variable in the formula with $x_i \in vars\; F$
    \item $c_i$ denotes the $i$-th clause in the formula with $c_i \in F$
    \item $p_{ij}$ denotes the $j$-th position/literal in the $i$-th clause with $p_{ij} \in c_i$
\end{enumerate} 
Then we construct a set $X$ and which contains all 3 different kinds objects. 
\begin{align*}
    X = vars\; F \cup F \cup \bigcup_{c_i \in F} c_i
\end{align*}
Furthermore, we construct $S$, a collection of subsets of $X$. We determine the following subsets
\begin{enumerate}
    \item $\{p_{ij}\}$. The unary set of positions
    \item $\{c_i, p_{ij}\}$. The binary set of a clause and a position in it.
    \item $pos(x_i) := \{x_i\} \cup \{p_{ab} | p_{ab} = x_i\}$. The set of its positive occurrences as positions.
    \item $neg(x_i):= \{x_i\} \cup \{p_{ab} | p_{ab} = \neg x_i\}$. The set of a variable with  its negative occurrences as positions.
\end{enumerate}
$S$ contains all of the four types of subsets.
\begin{align*}
    S =& \{{p_{ij}} | p_{ij} \in c_i, c_i \in F \} 
    \cup \{\{c_i, p_{ij}\} | p_{ij} \in c_i, c_i \in F \} \\
    &\cup \{\{x_i\} \cup \{p_{ij} | p_{ij} \in c_i, c_i \in F\} | x_i \in vars\; F, x_i = p_{ij}\}\\
    &\cup \{\{x_i\} \cup \{p_{ij} | p_{ij} \in c_i, c_i \in F\} | x_i \in vars\; F, \neg x_i = p_{ij}\}
\end{align*}
The pair of $(X, S)$ is the input for the \XC\ problem. 
\begin{lemma}[Soundess]
    Let $F$ be satisfiable. The pair $(X, S)$ is then an instance of the exact cover.
\end{lemma}
Let $\sigma \models F$ be a valid assignment. We construct an exact cover $S' \subseteq S$ of $X$ in the following steps.
\begin{enumerate}
    \item For each $x_i \in vars\; F$, $pos(x)$ is included in $S'$ if $\sigma(pos(x)) \equiv \top$. Otherwise we insert $neg(x)$ into $S'$.
    \item For each $c_i \in F$, we choose the minimal $j$ with $\sigma(p_{ij}) \equiv \top$, and insert $\{c_i, p_{ij}\}$ into $S'$
    \item For each $p_{ij} \in c_i$, if $\sigma(p_{ij}) \equiv \top$ and $\{c_i, p_{ij}\}$ is not in $S'$, the unary set $\{p_{ij}\}$ is included. 
\end{enumerate}
Obviously, each position in $pos(x)$ and $neg(x)$ will be false under the assignment $\sigma$, 
while the positions in the other sets are all true. By design, the positions in the second and the third steps never duplicate. 
Thus, no same position occurs in two different sets in the collection $S'$. 
Furthermore, each clause exists in exactly one set in the second step, which is also the case for the variables in the first step.
Hence $S'$ is disjoint. \\\\
From this fact, we can also conclude that clauses and variables are covered in $S'$. 
Now we only have to show that all the positions are covered. If a position $p_{ij}$ is false under $\sigma$, 
it is covered in the first step. Otherwise it is either covered in the second step or the third step. 
With the disjointness, we may conclude that $S'$ covers $X$ exactly and that the reduction is sound.
\begin{lemma}[Completeness]
    Let $(X, S)$ be reduced from $F$. If $(X, S)$ is an instance of the exact cover, $F$ has to be satisfiable.
\end{lemma}
Given an exact cover pair $(X, S)$ reduced from $F$, it is easy to reconstruct the model $\sigma$ with the same approach as in the proof of the soundness, 
showing that $F$ is satisfiable. Thus, the completeness of the reduction is proven. 
\begin{lemma}[Polynomial Complexity]
    The construction of $(X, S)$ from $F$ is polynomial. 
\end{lemma}
In the reduction, we have to iterate all of the variables, the clauses and the positions. 
Thus, we have to find a polynomial bound with regards to three metrics. Let $n, m$ and $k$ denotes 
the number of variables, clauses and postitions respectively. To derive the three metrics, we have to iterate 
all of the clauses, resulting the complexity of \bigO{m}. Unexpectedly, this results in the set $X$, 
indicating a linear complexity for the construction. \\\\
Now the interesting part is the collection $S$. For each type of subsets, we give a polynomial bound 
\begin{enumerate}
    \item $\{p_{ij}\}$. It is sufficient to merely iterate the positions, which requires the complexity of $k$.
    \item $\{c_i, p_{ij}\}$. Each clause is iterated for $|c_i|$ times. Since $|c_i|$ is a constant, there is a $c \in \mathbb{N}$ 
    s.t. $|c_i| \leq c$. Obviously, the complexity is above bounded by $c \cdot m$.
    \item $pos(x)$ and $neg(x)$. For each variable $x$, it is required to iterate all of the positions, which produces the complexity 
    of $2 \cdot nk$ in total.
\end{enumerate}
Thus, the construction costs the polynomial complexity of $k + cm + nk \in \mathcal{O}(nk + m)$. 
With the linear complexity of the construction of $X$, we conclude that the reduction has the polynomial complexity.

\subsection{Implementation Details}
\label{sec:sat-imp}
\subsubsection{Reduction and Proof}
Intuitively, the variables, positions and clause can be represented by indices or tuples of indices. However, it it not easy 
to unify the representation s.t. they are of the same type. One possible solution is introducing a new dimension in the tuple, 
and use it to classify the representated objects. However, we might still have to introduce a new enumerate type for this purpose. 
On the contrary, a container type is exempted from the tedious handling of tuples, although it still introduces a new type. Thus, 
we implement this container type with a few auxiliary functions \textbf{xc\_element} as folows. 
\Snippet{exact-cover-basics}
Then, it is possible to define the reduction function. 
\Snippet{exact-cover-red}
Proof of the correctness of the reduction argues about the disjointness and covering property by showing that a specific type of element 
is existent or non-existent in the constructed sets. Though the majority of the proof is lengthy, it does not require too many techniques 
and is overall trivial after applying the corresponding lemmas and definitions.\\\\
The only exception is the construction of $\{c_i, p_{ij}\}$ in the second step. $p_{ij}$ is chosen as the position with the least index. However, 
in our definition, there is no such indexing property in the \textbf{xc\_element} datatype, meaning that such construction is not possible. 
Fortunately, the choice of the $p_{ij}$ does not necessarily require a minimal index. Any arbitrary $p_{ij}$ that is true under the assignment 
$\sigma$ is a valid choice. For this reason, we chose to use the \textbf{SOME} predicate in Isabelle, which obtains an arbitrary instance that fulfills
the required property. 
\Snippet{exact-cover-prf} 
To end with, we show that the reduction is sound, complete, and consequently correct. 
\Snippet{exact-cover-correct}

\subsubsection{Polynomial Complexity}
To begin with, it is necessary to determine to metrics, on which the complexity is dependent. For 
a logical formula $F$, we will iterate all of the variables, clauses and positions. Hence all of them are need for as metrics. 
Nevertheless, the NREST implementation does not support a complexity bound with different metrics. As a result, it is necessary to 
choose the maximum of all metrics and use it as our sole metrics\footnote{A few previous reductions from \SAT\ uses the number of clauses 
as a metrics. It was also corrrect for those reductions iterated only the clauses.}. Similarly, we define $max |X| |S|$ as the metrics 
for the exact cover instance $(X, S)$. Then we can define the NREST algorithm.
\Snippet{exact-cover-poly}  
The proof of the polynomial bound is, however, hardly automated. Part of the reason is that Isabelle fails to find and apply the monotonicity 
of the space function, time function and the cardinality. For this reason, it is necessary to show such relationships. For example, one of them is about the 
cardinality
\Snippet{exact-cover-polyaux}
Finally, we show the \textit{refines} and \textit{size} lemma as well as that the reduction is polynomial.
\Snippet{exact-cover-final}

\section{Exact Hitting Set}
The hitting set problems are variants of the set covering problems. Essentially, they are two different ways 
of viewing the same problem. Just as the hitting set\footnote{Note that the exact hitting set problem was referred to as the hitting set problem in Karp's work, whereas 
it is generalized to be another problem nowadays.} is a variant of the set covering, the exact hitting set is 
a variant of the exact cover. 
\problem{\HS}{A collection of sets $S$}{Is there a finite set $W$ s.t. the intersection of $W$ and 
each element $s \in S$ contains exactly one element?}
\begin{align*}
   \textbf{Exact Hitting Set} := \{S\ |\ \exists W.\ \forall s \in S.\ |W \cap s| = 1\}
\end{align*}
 

\subsection{Reduction Details}
Given an exact cover pair $(X, S)$, the hitting set input $C$ is constructed by 
\begin{align*}
    C = \{\{s | u \in s, s \in S \} | u \in X\}
\end{align*}
Thus, $C$ is the set of sub-collections denoted by $c_u$. All sets in $c_u$ share the same element $u$.
\begin{lemma}[Soundess]
    Let $(X, S)$ be an exact cover instance. A collection $C$ reduced from $(X, S)$ is then an instance of the exact hitting set.
\end{lemma}
The soundness of this reduction is straightforwardly proven with the existence of $S'$ that covers $X$ exactly.
For the soundness of the reduction, it suffices to show 
\begin{align*}
    \exists W.\ \forall c_u \in C.\ |W \cap c_u| = 1
\end{align*}
Let $W = S'$ and $c_u = \{s | u \in s, s \in S \} \in C$ be an arbitrary element. 
Since $S'$ covers $X$ exactly, there is exactly one $s \in S'$ that contains $u$. Moreover, this $s$
is also included in the $c_u$, for $s \in S'$ and $S' \subseteq S$. Thus, it holds that $W \cap c_u = S' \cap c_u = \{s\}$ and consequently $|W \cap c_u| = 1$.
\begin{lemma}[Completeness]
    Let the collection $C$ be a collection reduced from a pair $(X, S)$. If $C$ is an instance of the exact hitting set, 
    $(X, S)$ has to be an instance of the exact cover.
\end{lemma}
The proof of the completeness shares a similar construction. The only difference is that $W$ is not 
necessarily a subset of $S$. Nevertheless, there exists a subset $W' \subseteq W$ s.t. it is not only a subset of $S'$, but it
also fulfills the same property as $W$. Let $S' = W'$, the completeness is then proven analogously as the soundness. 
\begin{lemma}[Polynomial Complexity]
    The construction of $C$ from $(X, S)$ is polynomial. 
\end{lemma}
Finally, we show that the reduction is polynomial. In our reduction, it is necessary to iterate the set $X$ and the collection $S$ in a nested loop. 
With the cardinality $|X|$ and $|S|$ as the metrics, it is obvious that the reduction costs the complexity of \bigO{|X||S|}.

\subsection{Implementation Details}
\subsubsection{Reduction and Proof}
Since the exact cover problem is defined over a finite set $X$ and a finite collection $S$, we have to check if the $X$ and $S$ are finite and 
if $S$ is a collection of $X$. Thus, a condition statement, which checks this requirement, is added to the implementation. Furthermore,
the proof of the correctness is implemented as described above. Following is a snippet of implemented definitions and lemmas.
\Snippet{exact-hitting-set-def}
\Snippet{exact-hitting-set-reduction}

\subsubsection{Polynomial Complexity}
We determine the size of the exact hitting set entry $C$ as $|C|$. According to the paradigm, 
we define the NREST algorithm and show the \textit{refines} and \textit{size} lemma as follows

\Snippet{exact-hitting-set-poly}

The proof of is mostly automated after unfolding the necessary definitions. 
However, an additional step is required for indicating the relationship between the sizing functions. 
While it holds $|C| = |X|$, 
the size of the exact cover is defined by $max |X| |S|$ instead of $|X|$. Hence we can
only conclude that the size of the exact hitting set is less equal than the size of the exact cover. 
The proof automation will then fails in showing $|C| \leq |S| \cdot |S| + 1$ when $|S| \geq |X|$. 
For this reason, we have to prove one additional lemma about the cardinality of the 
exact hitting set.

\Snippet{exact-hitting-set-aux}

Finally, we show that the reduciton is correct and polynomial. 

\Snippet{exact-hitting-set-final}






